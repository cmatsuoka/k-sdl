
#include <stdio.h>
#include "common.h"
#include "graphics.h"

static int font_index[] = {
	0x050, 0x064, 0x078, 0x08C, 0x0A0, 0x0B4, 0x0CC, 0x0E4, 0x0F8,
	0x10C, 0x120, 0x134, 0x13E, 0x152, 0x166, 0x17A, 0x192, 0x1AA,
	0x1BE, 0x1D2, 0x1E6, 0x1FA, 0x20E, 0x222, 0x236, 0x24E, 0x258,
	0x264, 0x26E, 0x27A
};

static int font_height[] = {
	10, 10, 10, 10, 10, 12, 11, 10, 10, 12,
	10, 10, 10, 10, 10, 12, 12, 10,  9, 10,
	10, 10, 10, 12, 12, 10, 10, 12, 10, 10
};

static int font_cols[] = {
	2, 2, 1, 2, 2, 2, 2, 2, 1, 1,
	2, 1, 2, 2, 2, 2, 2, 2, 2, 2,
	2, 2, 2, 1, 2, 2, 1, 1, 1, 1
};

static unsigned char font_data[] = {
/* A */	0x00, 0x1C, 0x38, 0x30, 0x7C, 0x67, 0x63, 0x73, 0x8E, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* B */ 0x00, 0x7B, 0xCF, 0xC7, 0x7F, 0xC7, 0x87, 0x87, 0xFF, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00,
/* C */ 0x00, 0x7C, 0xC7, 0x43, 0x03, 0x03, 0x83, 0x87, 0x7E, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C,
/* D */ 0x1E, 0x38, 0x7C, 0x66, 0xC3, 0xC3, 0xC3, 0xC7, 0x7C, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* E */ 0x00, 0x7C, 0x83, 0x03, 0x3F, 0x03, 0x03, 0x87, 0x7C, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* F */ 0x7C, 0x67, 0x07, 0x07, 0x07, 0x07, 0x07, 0x3F, 0x03, 0x03,
	0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
/* G */ 0x00, 0x3C, 0xE3, 0x43, 0x03, 0xE3, 0x83, 0x87, 0xFC, 0x80,
	0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x07,
/* H */ 0x07, 0x07, 0xFF, 0x8F, 0x87, 0x87, 0x87, 0xC7, 0xC7, 0x00,
	0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x00,
/* I */ 0x00, 0xFF, 0xE3, 0x70, 0x78, 0x3C, 0x1E, 0x0F, 0xFF, 0x00,
	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x00,
/* J */ 0x00, 0xFF, 0xE3, 0x70, 0x78, 0x3C, 0x1E, 0x0F, 0xFF, 0x00,
	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x07,
/* K */ 0x07, 0x87, 0xC7, 0x67, 0x37, 0x3F, 0x67, 0xC7, 0x87, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07,
/* L */ 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x3F, 0x00,
/* M */ 0x00, 0x77, 0xEF, 0xC7, 0xC7, 0xC7, 0xC7, 0xC7, 0xC7, 0x00,
	0x00, 0x0F, 0x1D, 0x38, 0x38, 0x38, 0x38, 0x1C, 0x3C, 0x00,
/* N */ 0x00, 0xE7, 0x9F, 0x87, 0x87, 0x87, 0x87, 0xC7, 0xC7, 0x00,
	0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x00,
/* O */ 0x00, 0x7E, 0xC3, 0x83, 0x83, 0x83, 0x83, 0x87, 0x78, 0x00,
        0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00,
/* P */ 0x00, 0xF7, 0x8F, 0x87, 0x87, 0x87, 0x87, 0x8F, 0xF7, 0x07,
	0x07, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x03, 0x01,
	0x00, 0x00, 0x00, 0x00,
/* Q */ 0x00, 0xFE, 0xC3, 0x83, 0x83, 0x83, 0x83, 0xC7, 0xBE, 0x80,
	0x80, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
	0x01, 0x01, 0x01, 0x00,
/* R */ 0x00, 0xF7, 0x8F, 0x87, 0x87, 0x87, 0x7F, 0xE7, 0x87, 0x00,
	0x00, 0x00, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x03, 0x00,
/* S */ 0x00, 0x38, 0x67, 0x07, 0x1C, 0x38, 0x60, 0x67, 0x3C, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C,
/* T */ 0x9C, 0xFF, 0x1D, 0x1C, 0x1C, 0x1C, 0x1C, 0x9C, 0xF8, 0x00,
	0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
/* U */ 0x00, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xE3, 0x9E, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
/* V */ 0x00, 0x87, 0x87, 0x8E, 0x8C, 0x5C, 0x78, 0x70, 0x70, 0x00,
	0x00, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* W */ 0x00, 0xC7, 0x87, 0x8E, 0x8E, 0x5C, 0x7C, 0x38, 0x38, 0x00,
	0x00, 0xC1, 0x41, 0x21, 0x23, 0x36, 0x3C, 0x1C, 0x1C, 0x00,
/* X */ 0x00, 0x43, 0x67, 0x3E, 0x1C, 0x3C, 0x76, 0x63, 0xC1, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* Y */ 0x00, 0x07, 0x0E, 0x9C, 0x9C, 0xB8, 0x78, 0x40, 0x60, 0x6C,
	0x38, 0x00, 0x00, 0x07, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
/* Z */ 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00,
/* ? */ 0x00, 0x1E, 0x1C, 0x1C, 0x1C, 0x1C, 0x1C, 0x1C, 0x1C, 0x1D,
	0x0F, 0x00,
/* . */ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x00,
/* , */ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03,
	0x01, 0x00,
/* : */ 0x00, 0x00, 0x00, 0x03, 0x03, 0x00, 0x03, 0x03, 0x00, 0x00,
	0x00, 0x00
};

void write_text(char *text, unsigned char *buffer)
{
	for (; *text; text++) {
		int c = *text - 'a';
		int index, data;
		int height, cols;
		int i, j, k;

		if (c < 0 || c >= 30) {
			buffer += 8;
			continue;
		}

		index = font_index[c] - 0x50;
		height = font_height[c];
		cols = font_cols[c];

		for (i = 0; i < cols; i++) {
			for (j = 0; j < height; j++) {
				data = font_data[index + i * height + j];
				for (k = 0; k < 8; k++) {
					int d = data & 0x01 ? 0x03 : 0x00;
					buffer[i * 8 + j * FB_WIDTH + k] = d;
					data >>= 1;

				}
			}
		}
		buffer += 10;
	}
}
