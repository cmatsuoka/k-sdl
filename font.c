#include <stdio.h>
#include "common.h"
#include "graphics.h"

#define MAX_FONT 30

/* Unscramble font indexes:
    8 <-> 25
    9 <-- 26
   26 <-- 27
   27 <-- 28
   28 <-- 29
   29 <-- 28
*/

static int font_index[MAX_FONT] = {
	  0,  20,  40,  60,  80, 100, 124, 148, 510, 188,
	208, 228, 238, 258, 278, 298, 322, 346, 366, 386,
	406, 426, 446, 466, 486, 168, 532, 542, 554, 566
};

static unsigned char font_cols[MAX_FONT] = {
	2, 2, 1, 2, 2, 2, 2, 2, 1, 1,
	2, 1, 2, 2, 2, 2, 2, 2, 2, 2,
	2, 2, 2, 1, 2, 2, 1, 1, 1, 1
};

static unsigned char font_height[MAX_FONT] = {
	10, 10, 10, 10, 10, 12, 11, 10, 10, 12,
	10, 10, 10, 10, 10, 12, 12, 10,  9, 10,
	10, 10, 10, 12, 12, 10, 10, 12, 10, 10
};

static unsigned char font_width[MAX_FONT] = {
	 9, 11,  9, 11, 10,  8, 11, 11,  6,  7,
	11,  7, 16, 12, 11, 14, 14, 14, 10, 11,
	11, 11, 17, 11, 11, 11,  7,  7,  7,  8
};

static unsigned char font_data[] = {
/* a */	0x00, 0x1c, 0x38, 0x30, 0x7c, 0x67, 0x63, 0x73, 0x8e, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* b */ 0x00, 0x7b, 0xcf, 0xc7, 0x7f, 0xc7, 0x87, 0x87, 0xff, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00,
/* c */ 0x00, 0x7c, 0xc7, 0x43, 0x03, 0x03, 0x83, 0x87, 0x7e, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
/* d */ 0x1e, 0x38, 0x7c, 0x66, 0xc3, 0xc3, 0xc3, 0xc7, 0x7c, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* e */ 0x00, 0x7c, 0x83, 0x03, 0x3f, 0x03, 0x03, 0x87, 0x7c, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* f */ 0x7c, 0x67, 0x07, 0x07, 0x07, 0x07, 0x07, 0x3f, 0x03, 0x03,
	0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
/* g */ 0x00, 0x3c, 0xe3, 0x43, 0x03, 0xe3, 0x83, 0x87, 0xfc, 0x80,
	0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x07,
/* h */ 0x07, 0x07, 0xff, 0x8f, 0x87, 0x87, 0x87, 0xc7, 0xc7, 0x00,
	0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x00,
/* z */ 0x00, 0xff, 0xe3, 0x70, 0x78, 0x3c, 0x1e, 0x0f, 0xff, 0x00,
	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x00,
/* j */ 0x00, 0xff, 0xe3, 0x70, 0x78, 0x3c, 0x1e, 0x0f, 0xff, 0x00,
	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x07,
/* k */ 0x07, 0x87, 0xc7, 0x67, 0x37, 0x3f, 0x67, 0xc7, 0x87, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07,
/* l */ 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x3f, 0x00,
/* m */ 0x00, 0x77, 0xef, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x00,
	0x00, 0x0f, 0x1d, 0x38, 0x38, 0x38, 0x38, 0x1c, 0x3c, 0x00,
/* n */ 0x00, 0xe7, 0x9f, 0x87, 0x87, 0x87, 0x87, 0xc7, 0xc7, 0x00,
	0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x00,
/* o */ 0x00, 0x7e, 0xc3, 0x83, 0x83, 0x83, 0x83, 0x87, 0x78, 0x00,
        0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00,
/* p */ 0x00, 0xf7, 0x8f, 0x87, 0x87, 0x87, 0x87, 0x8f, 0xf7, 0x07,
	0x07, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x03, 0x01,
	0x00, 0x00, 0x00, 0x00,
/* q */ 0x00, 0xfe, 0xc3, 0x83, 0x83, 0x83, 0x83, 0xc7, 0xbe, 0x80,
	0x80, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
	0x01, 0x01, 0x01, 0x00,
/* r */ 0x00, 0xf7, 0x8f, 0x87, 0x87, 0x87, 0x7f, 0xe7, 0x87, 0x00,
	0x00, 0x00, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x03, 0x00,
/* s */ 0x00, 0x38, 0x67, 0x07, 0x1c, 0x38, 0x60, 0x67, 0x3c, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
/* t */ 0x9c, 0xff, 0x1d, 0x1c, 0x1c, 0x1c, 0x1c, 0x9c, 0xf8, 0x00,
	0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
/* u */ 0x00, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xc3, 0xe3, 0x9e, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
/* v */ 0x00, 0x87, 0x87, 0x8e, 0x8c, 0x5c, 0x78, 0x70, 0x70, 0x00,
	0x00, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* w */ 0x00, 0xc7, 0x87, 0x8e, 0x8e, 0x5c, 0x7c, 0x38, 0x38, 0x00,
	0x00, 0xc1, 0x41, 0x21, 0x23, 0x36, 0x3c, 0x1c, 0x1c, 0x00,
/* x */ 0x00, 0x43, 0x67, 0x3e, 0x1c, 0x3c, 0x76, 0x63, 0xc1, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
/* y */ 0x00, 0x07, 0x0e, 0x9c, 0x9c, 0xb8, 0x78, 0x40, 0x60, 0x6c,
	0x38, 0x00, 0x00, 0x07, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00,
/* i */ 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00,
/* ? */ 0x00, 0x1e, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1d,
	0x0f, 0x00,
/* . */ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x00,
/* , */ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03,
	0x01, 0x00,
/* : */ 0x00, 0x00, 0x00, 0x03, 0x03, 0x00, 0x03, 0x03, 0x00, 0x00,
	0x00, 0x00
};

void write_text(char *text, unsigned char *buffer)
{
	for (; *text; text++) {
		int c = *text - 'a';
		int index, data;
		int height, cols;
		int i, j, k;

		if (c < 0 || c >= MAX_FONT) {
			buffer += 8;
			continue;
		}

		index = font_index[c];
		height = font_height[c];
		cols = font_cols[c];

		for (i = 0; i < cols; i++) {
			for (j = 0; j < height; j++) {
				data = font_data[index + i * height + j];
				for (k = 0; k < 8; k++) {
					int d = data & 0x01 ? 0x03 : 0x00;
					buffer[i * 8 + j * FB_WIDTH + k] = d;
					data >>= 1;

				}
			}
		}
		buffer += font_width[c];
	}
}
